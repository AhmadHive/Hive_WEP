{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .news-detail {
        padding: 6rem 5% 3rem;
        min-height: 100vh;
        position: relative;
    }

    .news-article {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
    }

    .article-header {
        padding: 3rem 3rem 2rem;
        text-align: center;
    }

    .article-title {
        font-size: 2.2rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
        line-height: 1.3;
    }

    .article-meta {
        display: flex;
        justify-content: center;
        gap: 2rem;
        color: #666;
        font-size: 0.9rem;
        flex-wrap: wrap;
    }

    .article-image {
        width: 100%;
        max-height: 500px;
        overflow: hidden;
    }

    .article-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .article-content {
        padding: 3rem;
        font-size: 1.1rem;
        line-height: 1.8;
    }

    .article-content p {
        margin-bottom: 1.5rem;
    }

    .article-content h2, .article-content h3 {
        color: var(--primary-color);
        margin: 2rem 0 1rem;
    }

    .article-footer {
        padding: 2rem 3rem;
        border-top: 1px solid #eee;
        text-align: center;
    }

    .back-to-news {
        background: var(--secondary-color);
        color: var(--text-dark);
        padding: 0.75rem 1.5rem;
        border-radius: var(--border-radius);
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: var(--transition);
    }

    .back-to-news:hover {
        transform: translateX(-5px);
    }

    /* شريط تقدم القراءة */
    .reading-progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(3, 39, 82, 0.2);
        position: fixed;
        top: 70px;
        left: 0;
        z-index: 101;
    }

    .reading-progress-fill {
        height: 100%;
        background: var(--secondary-color);
        width: 0%;
        transition: width 0.3s ease;
    }

    .reading-progress-indicator {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--secondary-color);
        color: var(--text-dark);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        z-index: 100;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    @media (max-width: 768px) {
        .article-header {
            padding: 2rem 2rem 1.5rem;
        }

        .article-title {
            font-size: 1.8rem;
        }

        .article-content {
            padding: 2rem;
            font-size: 1rem;
        }

        .article-meta {
            flex-direction: column;
            gap: 0.5rem;
        }

        .reading-progress-indicator {
            bottom: 15px;
            right: 15px;
            font-size: 0.7rem;
            padding: 0.4rem 0.8rem;
        }
    }

    @media (max-width: 480px) {
        .news-detail {
            padding: 5rem 1rem 2rem;
        }

        .article-header {
            padding: 1.5rem;
        }

        .article-title {
            font-size: 1.5rem;
        }

        .article-content {
            padding: 1.5rem;
        }

        .article-footer {
            padding: 1.5rem;
        }

        .reading-progress-indicator {
            bottom: 10px;
            right: 10px;
        }
    }
</style>

<!-- شريط تقدم القراءة -->
<div class="reading-progress-bar">
    <div class="reading-progress-fill" id="reading-progress-fill"></div>
</div>

<section class="news-detail">
    <article class="news-article">
        <div class="article-header">
            <h1 class="article-title">{{ news_item.title }}</h1>
            <div class="article-meta">
                <span class="publish-date">
                    <i class="far fa-calendar"></i>
                    {{ news_item.publish_date|date:"F d, Y" }}
                </span>
                <span class="author">
                    <i class="far fa-user"></i>
                    By {{ news_item.author.get_full_name|default:news_item.author.username }}
                </span>
            </div>
        </div>
        
        <div class="article-image">
            <img src="{{ news_item.image.url }}" alt="{{ news_item.title }}">
        </div>
        
        <div class="article-content">
            {{ news_item.content|linebreaks }}
        </div>
        
        <div class="article-footer">
            <a href="{% url 'news' %}" class="back-to-news">
                <i class="fas fa-arrow-left"></i> Back to News
            </a>
        </div>
    </article>
</section>

<!-- مؤشر تقدم القراءة -->
<div class="reading-progress-indicator" id="reading-progress-text">0%</div>

<script>
    // تتبع تقدم القراءة
    document.addEventListener('DOMContentLoaded', function() {
        const progressFill = document.getElementById('reading-progress-fill');
        const progressText = document.getElementById('reading-progress-text');
        const newsArticle = document.querySelector('.news-article');
        let readingProgress = 0;

        function updateReadingProgress() {
            const scrollTop = window.pageYOffset;
            const articleTop = newsArticle.offsetTop;
            const articleHeight = newsArticle.offsetHeight;
            const windowHeight = window.innerHeight;
            
            if (scrollTop >= articleTop) {
                const progress = ((scrollTop - articleTop) / (articleHeight - windowHeight)) * 100;
                readingProgress = Math.min(100, Math.max(0, progress));
                
                progressFill.style.width = readingProgress + '%';
                progressText.textContent = Math.round(readingProgress) + '%';
                
                // حفظ التقدم في localStorage
                const articleId = window.location.pathname;
                localStorage.setItem(`readingProgress_${articleId}`, readingProgress);
            }
        }

        // استعادة التقدم المحفوظ
        const articleId = window.location.pathname;
        const savedProgress = localStorage.getItem(`readingProgress_${articleId}`);
        if (savedProgress) {
            setTimeout(() => {
                const targetScroll = newsArticle.offsetTop + (newsArticle.offsetHeight * savedProgress / 100);
                window.scrollTo({ top: targetScroll, behavior: 'smooth' });
            }, 500);
        }

        // تحديث التقدم عند التمرير وتغيير حجم النافذة
        window.addEventListener('scroll', updateReadingProgress);
        window.addEventListener('resize', updateReadingProgress);

        // تحديث أولي
        updateReadingProgress();

        // إضافة تأثيرات إضافية
        const progressIndicator = document.getElementById('reading-progress-text');
        
        // إظهار/إخفاء المؤشر عند التمرير
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            progressIndicator.style.opacity = '1';
            
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(function() {
                progressIndicator.style.opacity = '0.7';
            }, 1500);
        });

        // تفاعل عند النقر على المؤشر
        progressIndicator.addEventListener('click', function() {
            if (readingProgress >= 90) {
                // العودة للأعلى إذا كان المستخدم قرب النهاية
                window.scrollTo({ top: newsArticle.offsetTop, behavior: 'smooth' });
            } else {
                // التمرير لنهاية المقال
                const articleBottom = newsArticle.offsetTop + newsArticle.offsetHeight - window.innerHeight;
                window.scrollTo({ top: articleBottom, behavior: 'smooth' });
            }
        });

        // تلوين المؤشر بناءً على التقدم
        function updateProgressColor() {
            if (readingProgress >= 90) {
                progressIndicator.style.color = 'white';
            } else if (readingProgress >= 50) {
                progressFill.style.background = '#ffc107'; // أصفر عند المنتصف
                progressIndicator.style.background = '#ffc107';
                progressIndicator.style.color = 'var(--text-dark)';
            } else {
                progressFill.style.background = 'var(--secondary-color)'; // اللون الأساسي
                progressIndicator.style.background = 'var(--secondary-color)';
                progressIndicator.style.color = 'var(--text-dark)';
            }
        }

        // تحديث اللون مع التقدم
        window.addEventListener('scroll', function() {
            updateProgressColor();
        });
    });
</script>
{% endblock %}